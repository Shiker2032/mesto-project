(()=>{"use strict";var e="https://nomoreparties.co/v1/plus-cohort7/cards",t="https://nomoreparties.co/v1/plus-cohort7/users/me",n="https://nomoreparties.co/v1/plus-cohort7/cards/likes",o="d5427cfe-b46d-4e99-8eaf-124e3b1bb259",r=document.querySelector("[id='profile-form-close']"),i=document.querySelector("#popup-profile-edit"),c=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),u=document.querySelector("[id='popup-card']"),s=document.querySelector("[id='card-form-close']"),l=document.querySelector("#popup-image-container"),d=document.querySelector("#popup-image__close-button"),f=document.forms.profile_avatar_edit_form,p=document.querySelector("#popup-avatar-edit"),m=document.querySelector(".profile__avatar"),v=document.querySelector("#avatar-form-close"),h=f.querySelector("#avatar-url-input"),_=f.querySelector("#submit-avatar-btn");function y(e){document.addEventListener("keydown",S),e.addEventListener("click",k),e.classList.add("popup_state_visible")}function b(e){document.removeEventListener("keydown",S),e.removeEventListener("click",k),e.classList.remove("popup_state_visible")}function S(e){var t=document.querySelector(".popup_state_visible");"Escape"===e.key&&null!=t&&b(t)}function k(e){e.target.classList.contains("popup")&&b(e.target)}m.addEventListener("click",(function(){return y(p)})),f.addEventListener("submit",(function(e){var n;e.preventDefault(),_.textContent="Сохранить...",(n=h.value,fetch("".concat(t,"/avatar"),{method:"PATCH",headers:{authorization:o,"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(n)})}).then((function(e){return e.ok?e.json():Promise.reject("Reject: ".concat(e.status))}))).then((function(){m.src=h.value,f.reset(),_.disabled=!0,_.classList.add("form__button_disabled"),b(p)})).catch((function(e){return console.log(e)})).finally((function(){_.textContent="Сохранить"}))}));var q={formSelector:".form",inputSelector:".form__input",buttonSelector:".form__button",buttonDisableClass:"form__button_disabled",visibleErrorClass:"form__input-error_visible",inputInvalidClass:"input__element_invalid"};function L(e,t,n){var o=e.querySelector(n.buttonSelector);!function(e){return e.some((function(e){return!1===e.validity.valid}))}(t)?function(e,t){e.classList.remove(t.buttonDisableClass),e.disabled=!1}(o,n):function(e,t){e.classList.add(t.buttonDisableClass),e.disabled=!0}(o,n)}var E=document.querySelector("#photo-card-template").content.querySelector(".photo-card"),C=document.querySelector(".photo-cards"),g=document.querySelector("#popup-image-container"),j=g.querySelector(".popup-image__title"),x=document.querySelector(".popup-image__image"),w={};function D(t){var r=E.cloneNode(!0),i=r.querySelector(".photo-card__like-button"),c=r.querySelector(".photo-card__image"),a=r.querySelector(".photo-card__title"),u=r.querySelector(".photo-card__like-counter");a.textContent=t.name,c.alt=t.name,c.src=t.link,r.id=t._id,r.owner=t.owner_id,u.textContent=t.likes.length,r.isLiked=t.isLiked,t.isLiked&&i.classList.toggle("like-button_state_liked"),function(t){var r=t.querySelector(".photo-card__like-button"),i=t.querySelector(".photo-card__delete-button"),c=t.querySelector(".photo-card__image");i.addEventListener("click",(function(){var n;(n=t.id,fetch("".concat(e,"/").concat(n),{method:"DELETE",headers:{authorization:o}}).then((function(e){return e.ok?e.json():Promise.reject("Reject: ".concat(e.status))}))).then((function(){return t.remove()})).catch((function(e){return console.log(e)}))})),r.addEventListener("click",(function(e){var i,c=t.querySelector(".photo-card__like-counter");t.isLiked?function(e){return fetch("".concat(n,"/").concat(e),{method:"DELETE",headers:{authorization:o}}).then((function(e){return e.ok?e.json():Promise.reject("Reject: ".concat(e.status))}))}(t.id).then((function(e){c.textContent=e.likes.length,r.classList.remove("like-button_state_liked"),t.isLiked=!1})).catch((function(e){return console.log(e)})):(i=t.id,fetch("".concat(n,"/").concat(i),{method:"PUT",headers:{authorization:o}}).then((function(e){return e.ok?e.json():Promise.reject("Reject: ".concat(e.status))}))).then((function(e){c.textContent=e.likes.length,r.classList.add("like-button_state_liked"),t.isLiked=!0})).catch((function(e){return console.log(e)}))})),c.addEventListener("click",(function(e){var t=e.target;x.src=t.src,j.textContent=t.alt,x.alt=t.alt,y(g)}))}(r),r.owner!=w.id&&r.querySelector(".photo-card__delete-button").remove(),t.isNew?C.prepend(r):C.append(r)}function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function N(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var O,z=document.forms.card_edit_form,R=document.forms.profile_edit_form,T=document.querySelector("#popup-profile-edit"),A=R.querySelector("#submit-profile-button"),J=document.querySelector(".profile"),I=document.querySelector(".profile__avatar"),H=document.querySelector(".profile__edit-button"),M=z.querySelector("#card-name-input"),U=z.querySelector("#card-url-input"),B=z.querySelector("#submit-card-btn"),F=R.querySelector("[id='user-name-input']"),G=R.querySelector("[id='user-activity-input']"),K=J.querySelector(".profile__title"),Q=J.querySelector(".profile__subtitle"),V=N((function e(t,n,o,r,i,c,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.link=n,this._id=o,this.owner_id=r,this.likes=i,this.isNew=c,this.isLiked=a}));function W(){F.value=K.textContent,G.value=Q.textContent}function X(e){K.textContent=e.name,Q.textContent=e.about,I.src=e.avatar}z.addEventListener("submit",(function(t){t.preventDefault();var n=U.value,r=M.value;B.textContent="Создать...",function(t,n){return fetch(e,{method:"POST",headers:{authorization:o,"content-type":"application/JSON"},body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Reject: ".concat(e.status))}))}(r,n).then((function(e){D(new V(e.name,e.link,e._id,e.owner._id,e.likes,!0,!1)),z.reset(),B.classList.add("form__button_disabled"),B.disabled=!0,b(u)})).catch((function(e){return console.log(e)})).finally((function(){B.textContent="Создать"}))})),H.addEventListener("click",W),R.addEventListener("submit",(function(e){e.preventDefault(),A.textContent="Сохранить...",function(e,n){return fetch(t,{method:"PATCH",headers:{authorization:o,"content-type":"application/JSON"},body:JSON.stringify({name:e,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Reject: ".concat(e.status))}))}(F.value,G.value).then((function(e){X(e),b(T)})).catch((function(e){return console.log(e)})).finally((function(){A.textContent="Cохранить"}))})),c.addEventListener("click",(function(){return y(i)})),r.addEventListener("click",(function(){return b(i)})),a.addEventListener("click",(function(){return y(u)})),s.addEventListener("click",(function(){return b(u)})),d.addEventListener("click",(function(){return b(l)})),v.addEventListener("click",(function(){return b(p)})),W(),O=q,Array.from(document.querySelectorAll(q.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var o=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,n){e.classList.remove(n.inputInvalidClass),t.classList.remove(n.visibleErrorClass),t.textContent=""}(t,o,n):function(e,t,n,o){e.classList.add(o.inputInvalidClass),t.classList.add(o.visibleErrorClass),"card-url-input"===e.id?t.textContent="Не ссылка":t.textContent=n}(t,o,t.validationMessage,n)}(e,o,t),L(e,n,t)})),L(e,n,t)}))}(e,O)})),Promise.all([fetch(t,{headers:{authorization:o}}).then((function(e){return e.ok?e.json():Promise.reject("Reject: ".concat(e.status))})),fetch(e,{headers:{authorization:o,"content-type":"application/JSON"}}).then((function(e){return e.ok?e.json():Promise.reject("Reject: ".concat(e.status))}))]).then((function(e){return{userData:e[0],cardsData:e[1]}})).catch((function(e){return console.log(e)})).then((function(e){X(e.userData),w.id=e.userData._id,e.cardsData.forEach((function(t){var n=t.likes.some((function(t){return t._id==e.userData._id}));D(new V(t.name,t.link,t._id,t.owner._id,t.likes,!1,n))}))})).catch((function(e){return console.log(e)}))})();